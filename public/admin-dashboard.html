<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; display: flex; }
  nav { width: 220px; background: #2c3e50; color: white; min-height: 100vh; padding: 20px; }
  nav h3 { margin-top: 0; }
  nav a { color: white; display: block; margin: 15px 0; text-decoration: none; cursor: pointer; }
  .content { flex: 1; padding: 30px; background: #f4f4f4; min-height: 100vh; }
  .section { display: none; }
  .section.active { display: block; }
  .card { background: white; padding: 15px; margin: 10px 0; border-radius: 8px; box-shadow: 0 0 5px gray; }
  img { max-width: 100%; border-radius: 5px; margin-top: 10px; }
  form { background: white; padding: 20px; border-radius: 8px; max-width: 400px; box-shadow: 0 0 10px gray; }
  input, textarea, button { padding: 10px; margin-top: 10px; width: 100%; }
  button { background: teal; color: white; border: none; cursor: pointer; }
  button:hover { background: darkcyan; }
</style>
</head>
<body>

<nav>
  <h3>Admin Dashboard</h3>
  <a onclick="showSection('bookingsSection')">Bookings</a>
  <a onclick="showSection('packagesSection')">Packages</a>
  <a onclick="showSection('activitiesSection')">Activities</a>
  <a onclick="showSection('uploadPackageSection')">Upload Package</a>
  <a onclick="showSection('uploadActivitySection')">Upload Activity</a>
  <a onclick="logout()">Logout</a>
</nav>

<div class="content">
  <div id="bookingsSection" class="section active"><h2>User Bookings</h2><div id="bookingsList"></div></div>
  <div id="packagesSection" class="section"><h2>All Packages</h2><div id="packagesList"></div></div>
  <div id="activitiesSection" class="section"><h2>All Activities</h2><div id="activitiesList"></div></div>

  <div id="uploadPackageSection" class="section">
    <h2>Upload Package</h2>
    <form id="uploadPackageForm" enctype="multipart/form-data">
      <input type="text" name="title" placeholder="Package Title" required>
      <input type="number" name="price" placeholder="Price" required>
      <textarea name="description" placeholder="Description" required></textarea>
      <input type="text" name="category" placeholder="Category" required>
      <input type="file" name="image" accept="image/*" required>
      <button type="submit">Upload Package</button>
    </form>
  </div>

  <div id="uploadActivitySection" class="section">
    <h2>Upload Activity</h2>
    <form id="uploadActivityForm" enctype="multipart/form-data">
      <input type="text" name="name" placeholder="Activity Name" required>
      <textarea name="description" placeholder="Activity Description" required></textarea>
      <input type="text" name="location" placeholder="Location">
      <input type="file" name="image" accept="image/*" required>
      <button type="submit">Upload Activity</button>
    </form>
  </div>
</div>

<script>
const API_BASE = "https://mindandmedicineholidays.onrender.com";
const session = JSON.parse(localStorage.getItem("session"));

if (!session || !session.token || session.role !== "admin") {
  alert("You must be logged in as an admin!");
  window.location.href = "admin-login.html";
}

function showSection(id){
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  if(id === 'bookingsSection') loadBookings();
  if(id === 'packagesSection') loadPackages();
  if(id === 'activitiesSection') loadActivities();
}

// ✅ Fetch Bookings
async function loadBookings(){
  try {
    const res = await fetch(`${API_BASE}/api/bookings`, { headers:{ Authorization:`Bearer ${session.token}` }});
    const bookings = await res.json();
    const list = document.getElementById("bookingsList");
    list.innerHTML = bookings.length ? "" : "<p>No bookings yet.</p>";
    bookings.forEach(b => {
      const div = document.createElement("div");
      div.classList.add("card");
      div.innerHTML = `<p><b>User:</b> ${b.userId}</p>
                       <p><b>Package:</b> ${b.packageId}</p>
                       <p><b>Status:</b> ${b.status || "Pending"}</p>`;
      list.appendChild(div);
    });
  } catch (err) {
    console.error(err);
    alert("Failed to load bookings!");
  }
}

// ✅ Fetch Packages
async function loadPackages(){
  try {
    const res = await fetch(`${API_BASE}/api/packages`);
    const packages = await res.json();
    const list = document.getElementById("packagesList");
    list.innerHTML = packages.length ? "" : "<p>No packages found.</p>";
    packages.forEach(p => {
      const div = document.createElement("div");
      div.classList.add("card");
      div.innerHTML = `<h3>${p.title}</h3><img src="${API_BASE}${p.image}" alt="${p.title}"><p>${p.description}</p>`;
      list.appendChild(div);
    });
  } catch (err) {
    console.error(err);
    alert("Failed to load packages!");
  }
}

// ✅ Fetch Activities
async function loadActivities(){
  try {
    const res = await fetch(`${API_BASE}/api/activities`);
    const activities = await res.json();
    const list = document.getElementById("activitiesList");
    list.innerHTML = activities.length ? "" : "<p>No activities found.</p>";
    activities.forEach(a => {
      const div = document.createElement("div");
      div.classList.add("card");
      div.innerHTML = `<h3>${a.name}</h3><img src="${API_BASE}${a.image}" alt="${a.name}"><p>${a.description}</p>`;
      list.appendChild(div);
    });
  } catch (err) {
    console.error(err);
    alert("Failed to load activities!");
  }
}

// ✅ Upload Forms
document.getElementById("uploadPackageForm").addEventListener("submit", async (e)=>{
  e.preventDefault();
  const data = new FormData(e.target);
  const res = await fetch(`${API_BASE}/api/packages`, { method:"POST", headers:{ Authorization:`Bearer ${session.token}` }, body:data });
  if(res.ok){ alert("✅ Package uploaded!"); e.target.reset(); loadPackages(); } 
  else alert("❌ Upload failed!");
});

document.getElementById("uploadActivityForm").addEventListener("submit", async (e)=>{
  e.preventDefault();
  const data = new FormData(e.target);
  const res = await fetch(`${API_BASE}/api/activities`, { method:"POST", headers:{ Authorization:`Bearer ${session.token}` }, body:data });
  if(res.ok){ alert("✅ Activity uploaded!"); e.target.reset(); loadActivities(); } 
  else alert("❌ Upload failed!");
});

function logout(){
  localStorage.removeItem("session");
  window.location.href = "admin-login.html";
}

loadBookings();
loadPackages();
loadActivities();
</script>

</body>
</html>

